<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Lab: Build and Test Bootc Containers :: Building System Images for Red Hat Device Edge with Image Mode for RHEL</title>
    <link rel="prev" href="s1-podman.html">
    <link rel="next" href="s3-containerfiles.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building System Images for Red Hat Device Edge with Image Mode for RHEL</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-bootc-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhde-bootc-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building System Images for Red Hat Device Edge with Image Mode for RHEL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-intro/index.html">Introduction to Red Hat Device Edge and Image Mode for RHEL.</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/s1-rhde-and-image-mode.html">Provision and Manage Edge Devices with RHEL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/s2-edge-devices-quiz.html">Quiz: Use Cases for Edge Devices and Red Hat Device Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/s3-prereqs-lab.html">Lab: Prepare to Build and Deploy Bootc Container Images</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Build Bootc Container Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s1-podman.html">Build Bootc Containers With Podman</a>
  </li>
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s2-podman-lab.html">Lab: Build and Test Bootc Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3-containerfiles.html">Strategies for Building Bootc Container Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s4-containerfiles-lab.html">Lab: System Configuration From Containers</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch3-validate/index.html">Test Bootc Containers for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-validate/s1-bootc-anaconda.html">Test Bootc Containers With Anaconda</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-validate/s2-install-lab.html">Lab: Test Bootc Containers With Anaconda</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-validate/s3-troubleshoot-lab.html">Lab: Troubleshoot Bootc Containers and Their Containerfiles</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch4-publish/index.html">Publish Bootc Containers for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-publish/s1-registry.html">Strategies for Publishing and Distributing Bootc Container Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-publish/s2-bootc-install-lab.html">Lab: Publish a Bootc Container Image in a Private Container Registry</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building System Images for Red Hat Device Edge with Image Mode for RHEL</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building System Images for Red Hat Device Edge with Image Mode for RHEL</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building System Images for Red Hat Device Edge with Image Mode for RHEL</a></li>
    <li><a href="index.html">Build Bootc Container Images for Edge Devices</a></li>
    <li><a href="s2-podman-lab.html">Lab: Build and Test Bootc Containers</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Lab: Build and Test Bootc Containers</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>7 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Create containerfiles and build bootc container images suitable to edge systems running Red Hat Device Edge.</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending review
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_before_you_begin"><a class="anchor" href="#_before_you_begin"></a>Before you Begin</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You need a <em>development machine</em> running RHEL, to which you have access using an unprivileged user account.</p>
</div>
<div class="paragraph">
<p>These instructions were tested on RHEL 10.0 but should work with minimal or no change on and newer and older RHEL releases, since 9.6.</p>
</div>
<div class="paragraph">
<p>If you are using the course classroom, you will log in on the <code>workstation</code> VM as the user <code>student</code> with password <code>student</code>.
If not, please adapt the instructions to your test environment.</p>
</div>
<div class="paragraph">
<p>Make sure you verified your test environment by following the <a href="../ch1-intro/s3-prereqs-lab.html" class="xref page">first lab</a> of this course.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_instructions"><a class="anchor" href="#_instructions"></a>Instructions</h2>
<div class="sectionbody">
<div class="paragraph">
<p>You will build a containerfile that produces a bootc container image which includes a single-page web application, and test that container image as an application container.
You will also compare the bootc container image for your application with a regular application image for the same application.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Prepare to start this activity by cloning the sample code repository and logging in the private registry.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Create a local clone of the sample code repository of this course, and make it your working directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>git clone https://github.com/RedHatQuickCourses/rhde-bootc-samples.git</strong>
Cloning into 'rhde-bootc-samples'...
...
$ <strong>cd rhde-bootc-samples</strong></code></pre>
</div>
</div>
</li>
<li>
<p>If needed, login to your private registry.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman login -u student -p redhat registry.lab.example.com:5000</strong>
Login Succeeded!</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Inspect the containerfile for a single-page web application, which uses the Apache Web Server to host your HTML and JavaScript code.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Enter the directory <code>httpd-bootc</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cd httpd-bootc</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Review the containerfile.
It installs the <code>httpd</code> package and enables the <code>httpd</code> service, them adds HTML files that mock a singe-page web application.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">FROM registry.lab.example.com:5000/rhel10/rhel-bootc:10.0
ADD yum.repos.d /etc/yum.repos.d
RUN dnf install -y httpd &amp;&amp; systemctl enable httpd &amp;&amp; dnf clean all
ADD html /var/www/html</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the container file does NOT define any of the usual container image metadata, such as <code>ENV</code>, <code>USER</code>, or <code>VOLUME</code>.
It also does not define neither an <code>ENTRYPOINT</code> nor a <code>CMD</code>.</p>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Build and test the bootc container image for your single-page web application.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Build your bootc container image.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman build -t httpd-bootc .</strong>
...
Successfully tagged localhost/httpd-bootc:latest</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
The last argument of the <code>podman build</code> command above is a dot, for the current directory.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Run the bootc container image as a rootless application container.</p>
<div class="paragraph">
<p>Because unprivileged processes cannot access the standard HTTP port (80), configure port-forwarding from a higher port number.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman run -d -p 8080:80 --name httpd httpd-bootc</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Use either a web browser or the Curl utility to access the mock of our single-page web application.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl 127.0.0.1:8080</strong>
This would be the HTML and JavaScript code of your single-page web application.</code></pre>
</div>
</div>
</li>
<li>
<p>Verify that your bootc container image inherits the <code>containers.bootc</code> label key from the bootc base image.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>skopeo inspect --format '{{ index .Labels "containers.bootc" }}' containers-storage:localhost/httpd-bootc</strong>
1</code></pre>
</div>
</div>
</li>
<li>
<p>Inspect the processes running inside your bootc container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman exec -it httpd bash</strong>
bash-5.2# <strong>ps ax | wc -l</strong>
25
bash-5.2# <strong>pstree</strong>
systemd-+-NetworkManager---3*[{NetworkManager}]
        |-dbus-broker-lau---dbus-broker
        |-gssproxy---5*[{gssproxy}]
        |-httpd-+-httpd
        |       |-httpd---68*[{httpd}]
        |       `-2*[httpd---52*[{httpd}]]
        |-rhsmcertd---{rhsmcertd}
        |-rpcbind
        |-sshd
        |-systemd-journal
        |-systemd-logind
        |-systemd-userdbd---4*[systemd-userwor]
        `-udisksd---6*[{udisksd}]
bash-5.2# <strong>exit</strong>
exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>There are many processes that are NOT common in application containers, such as the NetworkManager, DBus, and SSH daemons.</p>
</div>
</li>
<li>
<p>Stop and delete your bootc container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman stop httpd</strong>
httpd
$ <strong>podman rm httpd</strong>
httpd</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>If you feel that our first bootc container could work basically the same way as a simple application container, you are right.
Let&#8217;s compare our bootc container with a regular application container for the same application.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Change to the <code>httpd-ubi</code> directory</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cd ../httpd-ubi</strong></code></pre>
</div>
</div>
</li>
<li>
<p>The containerfile uses the standard UBI image, so it must install the <code>systemd</code> package and start the Systemd daemon as its <code>ENTRYPOINT</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">FROM registry.lab.example.com:5000/ubi10/ubi:10.0
ADD yum.repos.d /etc/yum.repos.d
RUN dnf install -y systemd httpd &amp;&amp; systemctl enable httpd &amp;&amp; dnf clean all
ADD html /var/www/html
ENTRYPOINT ["/lib/systemd/systemd"]</code></pre>
</div>
</div>
</li>
<li>
<p>This containerfile is NOT a good example of a static web application, because it was designed to be as close as possible to our bootc container image, but it would be a representative example of a "lift and shift" approach to containerize an application.</p>
<div class="paragraph">
<p>It violates a few recommendations for application containers, among them:</p>
</div>
<div class="olist lowerroman">
<ol class="lowerroman" type="i">
<li>
<p>It runs more processes than the application really requires.
It should start the Apache Web Server as its <code>ENTRYPOINT</code>, instead of the System daemon.</p>
</li>
<li>
<p>It does NOT send logs to the standard output, so those logs are NOT visible with <code>podman logs</code> and would also NOT be visible from <code>kubectl logs</code> either, if run from a Kubernetes cluster.</p>
</li>
<li>
<p>It runs as <code>root</code>, because it does not set a <code>USER</code>.</p>
</li>
<li>
<p>It listens to a privileged TCP port (80), as per the default Apache Web Server configuration.
It should listen to an unprivileged port, to not require elevated privileges when run in a Kubernetes cluster.</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Providing a good example of a containerfile for a web application is outside the scope of this course.
</td>
</tr>
</table>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Build and run the application container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman build -t httpd-ubi .</strong>
...
Successfully tagged localhost/httpd-ubi:latest
$ <strong>podman run -d -p 8080:80 --name httpd httpd-ubi</strong>
...
$ <strong>curl 127.0.0.1:8080</strong>
This would be the HTML and JavaScript code of your single-page web application.</code></pre>
</div>
</div>
</li>
<li>
<p>Inspect the processes running inside your application container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman exec -it httpd bash</strong>
[root@965ed65344f0 /]# <strong>ps ax | wc -l</strong>
bash: ps: command not found
0
[root@965ed65344f0 /]# <strong>pstree</strong>
systemd─┬─httpd─┬─httpd
        │       ├─httpd───68*[{httpd}]
        │       └─2*[httpd───52*[{httpd}]]
        ├─systemd-journal
        └─systemd-userdbd───3*[systemd-userwor]
[root@965ed65344f0 /]# <strong>exit</strong>
exit</code></pre>
</div>
</div>
<div class="paragraph">
<p>Notice that the <code>ps</code> command is not available. Most most application containers do NOT include common troubleshooting commands and system services, so their container images are leaner.</p>
</div>
<div class="paragraph">
<p>Also notice, from the <code>pstree</code> output, that only the System daemon and Apache Web server are running.
It only runs a much smaller set of Systemd services, because it does not inherit Systemd configurations from the bootc base container image.</p>
</div>
</li>
<li>
<p>Stop and delete your application container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman stop httpd</strong>
httpd
$ <strong>podman rm httpd</strong>
httpd</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
<li>
<p>Because the HTML and JavaScript code of an application is NOT supposed to be managed as data, improve your containerfile to serve the application code from <code>/webapp</code> instead of from <code>/var/www</code>.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Change to the <code>webapp-bootc</code> directory.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>cd ../webapp-bootc</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Review its containerfile.</p>
<div class="paragraph">
<p>It uses a simple <code>sed</code> command search for <code>/var/www</code> and replace it by <code>/webapp</code>, in the Apache Web Server main configuration file.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">FROM registry.lab.example.com:5000/rhel10/rhel-bootc:10.0
ADD yum.repos.d /etc/yum.repos.d
RUN dnf install -y httpd &amp;&amp; systemctl enable httpd &amp;&amp; dnf clean all
ADD html /webapp/html
RUN chmod -R a+rX /webapp &amp;&amp; \
  sed -i '1,$ s?/var/www/?/webapp/?' /etc/httpd/conf/httpd.conf</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
That improved bootc container image has a serious issue, that you will NOT be able to see by simple testing using Podman.
If you can spot what the issue is, <strong>do NOT fix</strong> it yet.
We will see, later in this course, how to test the bootc container image in a way that makes that issue clear.
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Build your improved bootc container image.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman build -t webapp-bootc .</strong>
...
Successfully tagged localhost/webapp-bootc:latest</code></pre>
</div>
</div>
</li>
<li>
<p>Run your improved bootc container image as a rootless application container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman run -d -p 8080:80 --name webapp webapp-bootc</strong></code></pre>
</div>
</div>
</li>
<li>
<p>Use either a web browser or the Curl utility to view the mock of our single-page web application.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>curl 127.0.0.1:8080</strong>
This would be the HTML and JavaScript code of your IMPROVED single-page web application.</code></pre>
</div>
</div>
</li>
<li>
<p>Stop and delete your test container.</p>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-none hljs">$ <strong>podman stop webapp</strong>
webapp
$ <strong>podman rm webapp</strong>
webapp</code></pre>
</div>
</div>
</li>
</ol>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next"><a class="anchor" href="#_whats_next"></a>What&#8217;s next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next section presents some approaches for configuring Linux systems from a bootc container image.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="s1-podman.html">Build Bootc Containers With Podman</a></span>
  <span class="next"><a href="s3-containerfiles.html">Strategies for Building Bootc Container Images</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
