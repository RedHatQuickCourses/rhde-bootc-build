<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Build Bootc Containers With Podman :: Building System Images for Red Hat Device Edge with Image Mode for RHEL</title>
    <link rel="prev" href="index.html">
    <link rel="next" href="s2-podman-lab.html">
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">Building System Images for Red Hat Device Edge with Image Mode for RHEL</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/rhde-bootc-build/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="rhde-bootc-build" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Building System Images for Red Hat Device Edge with Image Mode for RHEL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../index.html">Home</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../LABENV/index.html">Lab Environment</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch1-intro/index.html">Introduction to Red Hat Device Edge and Image Mode for RHEL.</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/s1-rhde-and-image-mode.html">Provision and Manage Edge Devices with RHEL</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/s2-edge-devices-quiz.html">Quiz: Use Cases for Edge Devices and Red Hat Device Edge</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch1-intro/s3-prereqs-lab.html">Lab: Prepare to Build and Deploy Bootc Container Images</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="index.html">Build Bootc Container Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="s1-podman.html">Build Bootc Containers With Podman</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s2-podman-lab.html">Lab: Build and Test Bootc Containers</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s3-containerfiles.html">Strategies for Building Bootc Container Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="s4-containerfiles-lab.html">Lab: System Configuration From Containers</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch3-validate/index.html">Test Bootc Container Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-validate/s1-bootc-anaconda.html">Test Bootc Container Images with Anaconda</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-validate/s2-install-lab.html">Lab: Test Bootc Containers With Anaconda</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch3-validate/s3-troubleshoot-lab.html">Lab: Troubleshoot Bootc Containers and Their Containerfiles</a>
  </li>
</ul>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="../ch4-publish/index.html">Publish Bootc Container Images for Edge Devices</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-publish/s1-registry.html">Strategies for Publishing and Distributing Bootc Container Images</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../ch4-publish/s2-bootc-install-lab.html">Lab: Publish a Bootc Container in a Private Container Registry</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Building System Images for Red Hat Device Edge with Image Mode for RHEL</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Building System Images for Red Hat Device Edge with Image Mode for RHEL</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
    <li class="component">
      <a class="title" href="../../../samples/1/index.html">samples</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../../samples/1/index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Building System Images for Red Hat Device Edge with Image Mode for RHEL</a></li>
    <li><a href="index.html">Build Bootc Container Images for Edge Devices</a></li>
    <li><a href="s1-podman.html">Build Bootc Containers With Podman</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Build Bootc Containers With Podman</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p><em>Estimated reading time: <strong>8 minutes</strong>.</em></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Objective</dt>
<dd>
<p>Build system images for edge devices using Podman</p>
</dd>
</dl>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
Pending review
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_provisioning_and_updating_image_mode_systems"><a class="anchor" href="#_provisioning_and_updating_image_mode_systems"></a>Provisioning and updating image mode systems</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The workflow for provisioning and maintaining edge devices using image mode starts with common tools from the application containers world, and ends up with specialized tools from the bootc world.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s1-podman-fig-1.svg" alt="s1 podman fig 1">
</div>
<div class="title">Figure 1. Workflow for installing and updating image mode systems</div>
</div>
<div class="paragraph">
<p>In summary, the process is:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Create a containerfile, which refers to a base bootc container image, and which aggregates RHEL and third-party packages, configuration files, and optionally application container images in a single bootc container image.</p>
</li>
<li>
<p>Use Podman (or any other tool capable of producing OCI containers) to build a bootc container image from your containerfile.</p>
</li>
<li>
<p>Upload (push) your bootc container image to an OCI container registry, from where it can be downloaded (pull) to perform installation and updates of image mode systems.</p>
</li>
<li>
<p>Use the standard RHEL installer (Anaconda) with a custom kickstart file, which refers to the bootc container image as its installation source.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Alternatively, use the <em>bootc image builder</em> utility to convert your bootc container image into a custom RHEL installation media image, which you can write to an USB disk, or copy to a network boot server, and use it to install image mode systems without requiring access to an OCI container registry.</p>
</li>
</ol>
</div>
</li>
<li>
<p>Use the bootc utility, from an image mode system, to download a new bootc container image from a container registry and make it the new system image.</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Alternatively, use the bootc utility, from an image mode system, to copy a new bootc container image from removable storage and make it the new system image.</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>This course, which is the first in a series of three, focus on steps 1-4 above, up to the point you upload a bootc container image to a container image registry.
These are steps a developer would perform to create and test a bootc container image, as part of their <em>inner loop</em>.</p>
</div>
<div class="imageblock">
<div class="content">
<img src="_images/s1-podman-fig-2.svg" alt="s1 podman fig 2">
</div>
<div class="title">Figure 2. Scope of this course</div>
</div>
<div class="paragraph">
<p>The remaining steps are detailed in follow-up courses, and corresponds to steps an IT or OT professional would perform on actual edge devices, as part of an <em>outer loop</em>.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_what_is_bootc"><a class="anchor" href="#_what_is_bootc"></a>What is bootc</h2>
<div class="sectionbody">
<div class="paragraph">
<p><a href="https://bootc-dev.github.io/bootc/">Bootc</a> is the utility which performs installation and updates of image mode systems from OCI container images.
It is included as part of all bootc container images, and it is usually run as a privileged container from those images.</p>
</div>
<div class="paragraph">
<p>Developers and system administrators do NOT have to interact directly with the bootc utility to build bootc container images and provision image mode systems.
They only have to interact with the bootc utility to upgrade image mode systems.</p>
</div>
<div class="paragraph">
<p>The bootc utility is provided by a base bootc container image, and the process of building derived bootc container images looks just the same as the process for building derived application container images.</p>
</div>
<div class="sect2">
<h3 id="_bootc_containers_versus_application_containers"><a class="anchor" href="#_bootc_containers_versus_application_containers"></a>Bootc containers versus application containers</h3>
<div class="paragraph">
<p>If you remember from the previous chapter, bootc container images includes a number of components not usually included in application container images, among them:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>A Linux kernel and loadable modules</p>
</li>
<li>
<p>An initial ram disk (initrd) and a boot loader (grub)</p>
</li>
<li>
<p>The System Daemon (Systemd) and a number of privileged Systemd unit to manage hardware, networking, and system services</p>
</li>
<li>
<p>The D-Bus system messaging middleware</p>
</li>
<li>
<p>The bootc utility</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Typical OCI container images are designed to provide a single application, and include only the required user space components required to support that application, such a programming language runtime and required dependency libraries.
Bootc container images, on the other hand, are designed to provide a complete system, including its kernel mode components and possibly multiple applications, system services, and network services.</p>
</div>
<div class="paragraph">
<p>But, other than the fact that bootc container images are a lot bigger, they are standard OCI container images.
Nothing prevents you from running a bootc container using a standard container engine.
Just beware that the results might not be what you expect, because a container engine CANNOT run the kernel, system services, and other components from a bootc container image.
Container engines would run only the user space components of a bootc container image, as they would for a regular application container.</p>
</div>
<div class="paragraph">
<p>So bootc container images files are, at first, just container images with extra files, and the only obvious characteristic you can perceive in a containerfile for a bootc container images is the use of a bootc container image as its base image, in its <code>FROM</code> directive, instead of a regular application container image, such as an Universal Base Image (UBI).</p>
</div>
</div>
<div class="sect2">
<h3 id="_filesystem_layout_of_an_image_mode_system"><a class="anchor" href="#_filesystem_layout_of_an_image_mode_system"></a>Filesystem layout of an image mode system</h3>
<div class="paragraph">
<p>As you craft a containerfile to produce a bootc container image, you must be aware that bootc sets up the file systems of an image mode system in a very specific way:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The <code>/</code> directory, and almost all its subdirectories, like <code>/usr</code> and <code>/opt</code>, are read-only.
This gives image mode systems their <em>immutable</em> characteristic.</p>
</li>
<li>
<p>The <code>/etc</code> directory is read-write, so that system administrators are able the configurations of an image mode system at day-2.
The truth is, you cannot always pre-configure everything in a system image.</p>
</li>
<li>
<p>The <code>/var</code> directory is also read-write, so that applications can store user data, logs, and other data.</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
Describing an image mode system as "immutable", tough popular, is imprecise.
After all, parts of an image mode system MUST be mutable, else there would be no way of performing day-2 configuration changes nor storing application data and logs.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Some standard writable directories, such as <code>/home</code> and <code>/tmp</code>, that would exist in package mode systems, become symbolic links to directories under <code>/var</code> in image mode systems.
For example, <code>/home</code> is a symbolic link to <code>/var/home</code>.</p>
</div>
<div class="paragraph">
<p>If you need additional writable directories, for example to be mount points of additional disk devices, you must create them under <code>/var</code>, and possibly create symlinks to the locations these directories would be expected to be.
Symbolic links themselves can be read-only and still refer to a read-write directory.</p>
</div>
<div class="paragraph">
<p>You can and typically do include content of those writable directories in a bootc container image, but that content is treated differently when you install or update an image mode system:</p>
</div>
<div class="paragraph">
<p>During installation:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Files from <code>/etc</code> are copied from the bootc image to the actual image mode system, so they provide an initial configuration which can be modified, during installation time, by tools such as Anaconda kickstart and Cloud-init.</p>
</li>
<li>
<p>Files from <code>/var</code> are copied from the bootc image to the actual image mode system, so they provide an initial set of application data, and also data directories with the proper owners and file system permissions.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>During updates:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Files form <code>/etc</code> are merged between the current state in an image mode system and the state on the image.
This way, a bootc image can provide new configuration files, or changes to the default configuration files, without overriding configuration changes performed on the system at day-2.</p>
</li>
<li>
<p>Files from <code>/var</code> are ignored, retaining their state on the image mode system.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>There are other subtle differences in runtime behavior between an image mode system and a package mode system, which could affect the way applications are packaged and deployed in an image mode system.
These differences are, for the most part, not a reason to claim incompatibility between image mode and any specific application, but a reason to configure applications and systems in a different way, which you could also apply to package mode systems.</p>
</div>
<div class="paragraph">
<p>Most times, compatibility issues arise from applications that have hard-coded assumptions around system configuration.
If it happens, it may be necessary to change the application to replace those hard-coded assumption with configurable settings, or with a different assumption that matches typical configurations of an image mode system.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_building_bootc_containers_in_disconnected_mode"><a class="anchor" href="#_building_bootc_containers_in_disconnected_mode"></a>Building bootc containers in disconnected mode</h2>
<div class="sectionbody">
<div class="paragraph">
<p>It is a common security policy, especially at large corporations, that no software artifacts can be downloaded directly from the Internet.
They must be previously vetted by corporate TI to prevent compromises by artifacts infected with malware or from supply chain attacks.</p>
</div>
<div class="paragraph">
<p>As you build bootc container images, you usually install additional RPM packages from RHEL and third-party vendors.
If you cannot download those packages directly from Red Hat and their respective vendors, you must provide a mirror YUM or DNF repository containing them.</p>
</div>
<div class="paragraph">
<p>You must also provide, as part of your containerfile, YUM repository configurations that point to your mirrors.</p>
</div>
<div class="paragraph">
<p>By the same reason, you must provide a container registry with mirrors the bootc base container image and write your containerfile to refer to that private registry instead of to <code>redhat.registry.io</code></p>
</div>
<div class="paragraph">
<p>Notice that you would be required to do the same to build regular application container images in a disconnected environment.
These are NOT changes required by bootc alone.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_whats_next"><a class="anchor" href="#_whats_next"></a>What&#8217;s next</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The next activity builds a simple bootc container image and performs early testing of those images using Linux containers, to demonstrate the need for system testing in addition to container testing of bootc container images.</p>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Build Bootc Container Images for Edge Devices</a></span>
  <span class="next"><a href="s2-podman-lab.html">Lab: Build and Test Bootc Containers</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
